<div class="students-overview-container">
  <!-- Header with User Profile -->
  <div class="header">
    <div class="user-profile">
      <div class="user-avatar">
        <i class="{{userAvatar}}"></i>
      </div>
      <div class="user-details">
        <div class="user-name">{{ superAdminName }}</div>
        <div class="user-role">{{superAdminRole}}</div>
      </div>
    </div>
    <h1>Informacijski sistem študentov</h1>
  </div>

  <!-- Add Student Button -->
  <div class="actions">
    <p-button
      label="Dodaj novega študenta"
      icon="pi pi-plus"
      (onClick)="showAddDialog()"
      styleClass="p-button-success">
    </p-button>
  </div>

  <!-- Students Table -->
  <p-table
    [value]="students"
    [paginator]="true"
    [rows]="20"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Prikazujem {first} do {last} od {totalRecords} študentov"
    [rowsPerPageOptions]="[10, 20, 50, 100]"
    [tableStyle]="{ 'min-width': '50rem' }"
    styleClass="p-datatable-striped">

    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Ime</th>
        <th>Priimek</th>
        <th>E-pošta</th>
        <th>Datum vpisa</th>
        <th>Predmeti</th>
        <th>Uredi</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-student>
      <tr>
        <td>{{ student.id }}</td>
        <td>{{ student.firstName }}</td>
        <td>{{ student.lastName }}</td>
        <td>{{ student.email }}</td>
        <td>{{ student.enrollmentDate | date }}</td>
        <td>
          <span class="courses-list">{{ student.courses.join(', ') }}</span>
        </td>
        <td>
          <p-button
            icon="pi pi-pencil"
            styleClass="p-button-rounded p-button-warning p-button-text"
            (onClick)="showEditDialog(student)"
            pTooltip="Uredi predmete">
          </p-button>
          <p-button
            icon="pi pi-trash"
            styleClass="p-button-rounded p-button-danger p-button-text"
            (onClick)="deleteStudent(student)"
            pTooltip="Izbriši študenta">
          </p-button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" style="text-align: center;">Ni najdenih študentov.</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Add Student Dialog -->
  <p-dialog
    header="Dodaj novega študenta"
    [(visible)]="displayAddDialog"
    [modal]="true"
    [style]="{ width: '500px' }"
    [draggable]="false"
    [resizable]="false"
    [appendTo]="'body'">

    <form [formGroup]="studentForm">
      <div class="form-field">
        <label for="firstName">Ime *</label>
        <input
          id="firstName"
          type="text"
          pInputText
          formControlName="firstName"
          placeholder="Vnesite ime" />
        <small
          *ngIf="studentForm.get('firstName')?.invalid && studentForm.get('firstName')?.touched"
          class="p-error">
          Ime je obvezno (min 2 znaka)
        </small>
      </div>

      <div class="form-field">
        <label for="lastName">Priimek *</label>
        <input
          id="lastName"
          type="text"
          pInputText
          formControlName="lastName"
          placeholder="Vnesite priimek" />
        <small
          *ngIf="studentForm.get('lastName')?.invalid && studentForm.get('lastName')?.touched"
          class="p-error">
          Priimek je obvezen (min 2 znaka)
        </small>
      </div>

      <div class="form-field">
        <label for="email">E-pošta *</label>
        <input
          id="email"
          type="email"
          pInputText
          formControlName="email"
          placeholder="Vnesite e-poštni naslov" />
        <small
          *ngIf="studentForm.get('email')?.invalid && studentForm.get('email')?.touched"
          class="p-error">
          Veljaven e-poštni naslov je obvezen
        </small>
      </div>

      <div class="form-field">
        <label for="enrollmentDate">Datum vpisa *</label>
        <input
          id="enrollmentDate"
          type="date"
          pInputText
          formControlName="enrollmentDate" />
        <small
          *ngIf="studentForm.get('enrollmentDate')?.invalid && studentForm.get('enrollmentDate')?.touched"
          class="p-error">
          Datum vpisa je obvezen
        </small>
      </div>

      <div class="form-field">
        <label for="courses">Predmeti *</label>
        <p-multiSelect
          id="courses"
          [options]="availableCourses"
          formControlName="courses"
          placeholder="Izberite predmete"
          [style]="{'width': '100%'}"
          [filter]="true"
          filterPlaceHolder="Iskanje predmetov"
          [appendTo]="'body'"
          [panelStyle]="{'max-height': '300px'}">
        </p-multiSelect>
        <small
          *ngIf="studentForm.get('courses')?.invalid && studentForm.get('courses')?.touched"
          class="p-error">
          Vsaj en predmet je obvezen
        </small>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <p-button
        label="Prekliči"
        icon="pi pi-times"
        (onClick)="displayAddDialog = false"
        styleClass="p-button-text">
      </p-button>
      <p-button
        label="Dodaj študenta"
        icon="pi pi-check"
        (onClick)="addStudent()"
        [disabled]="studentForm.invalid">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Edit Student Dialog -->
  <p-dialog
    header="Uredi predmete študenta"
    [(visible)]="displayEditDialog"
    [modal]="true"
    [style]="{ width: '500px' }"
    [draggable]="false"
    [resizable]="false"
    [appendTo]="'body'">

    <div *ngIf="selectedStudent" class="student-info">
      <p><strong>Študent:</strong> {{ selectedStudent.firstName }} {{ selectedStudent.lastName }}</p>
      <p><strong>E-pošta:</strong> {{ selectedStudent.email }}</p>
    </div>

    <form [formGroup]="editStudentForm">
      <div class="form-field">
        <label for="editCourses">Predmeti *</label>
        <p-multiSelect
          id="editCourses"
          [options]="availableCourses"
          formControlName="courses"
          placeholder="Izberite predmete"
          [style]="{'width': '100%'}"
          [filter]="true"
          filterPlaceHolder="Iskanje predmetov"
          [appendTo]="'body'"
          [panelStyle]="{'max-height': '300px'}">
        </p-multiSelect>
        <small
          *ngIf="editStudentForm.get('courses')?.invalid && editStudentForm.get('courses')?.touched"
          class="p-error">
          Vsaj en predmet je obvezen
        </small>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <p-button
        label="Prekliči"
        icon="pi pi-times"
        (onClick)="displayEditDialog = false"
        styleClass="p-button-text">
      </p-button>
      <p-button
        label="Posodobi"
        icon="pi pi-check"
        (onClick)="updateStudent()"
        [disabled]="editStudentForm.invalid">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Confirmation Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
