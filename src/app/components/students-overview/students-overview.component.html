<div class="students-overview-container">
  <!-- Header with Super Admin Name -->
  <div class="header">
    <h1>Student Information System</h1>
    <div class="admin-info">
      <i class="pi pi-user"></i>
      <span>Super Admin: {{ superAdminName }}</span>
    </div>
  </div>

  <!-- Add Student Button -->
  <div class="actions">
    <p-button 
      label="Add New Student" 
      icon="pi pi-plus" 
      (onClick)="showAddDialog()"
      styleClass="p-button-success">
    </p-button>
  </div>

  <!-- Students Table -->
  <p-table 
    [value]="students" 
    [paginator]="true" 
    [rows]="20" 
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} students"
    [rowsPerPageOptions]="[10, 20, 50]"
    [tableStyle]="{ 'min-width': '50rem' }"
    styleClass="p-datatable-striped">
    
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Enrollment Date</th>
        <th>Courses</th>
        <th>Actions</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-student>
      <tr>
        <td>{{ student.id }}</td>
        <td>{{ student.firstName }}</td>
        <td>{{ student.lastName }}</td>
        <td>{{ student.email }}</td>
        <td>{{ student.enrollmentDate | date }}</td>
        <td>
          <span class="courses-list">{{ student.courses.join(', ') }}</span>
        </td>
        <td>
          <p-button 
            icon="pi pi-pencil" 
            styleClass="p-button-rounded p-button-warning p-button-text" 
            (onClick)="showEditDialog(student)"
            pTooltip="Edit Courses">
          </p-button>
          <p-button 
            icon="pi pi-trash" 
            styleClass="p-button-rounded p-button-danger p-button-text" 
            (onClick)="deleteStudent(student)"
            pTooltip="Delete Student">
          </p-button>
        </td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" style="text-align: center;">No students found.</td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Add Student Dialog -->
  <p-dialog 
    header="Add New Student" 
    [(visible)]="displayAddDialog" 
    [modal]="true" 
    [style]="{ width: '500px' }"
    [draggable]="false"
    [resizable]="false">
    
    <form [formGroup]="studentForm">
      <div class="form-field">
        <label for="firstName">First Name *</label>
        <input 
          id="firstName" 
          type="text" 
          pInputText 
          formControlName="firstName" 
          placeholder="Enter first name" />
        <small 
          *ngIf="studentForm.get('firstName')?.invalid && studentForm.get('firstName')?.touched" 
          class="p-error">
          First name is required (min 2 characters)
        </small>
      </div>

      <div class="form-field">
        <label for="lastName">Last Name *</label>
        <input 
          id="lastName" 
          type="text" 
          pInputText 
          formControlName="lastName" 
          placeholder="Enter last name" />
        <small 
          *ngIf="studentForm.get('lastName')?.invalid && studentForm.get('lastName')?.touched" 
          class="p-error">
          Last name is required (min 2 characters)
        </small>
      </div>

      <div class="form-field">
        <label for="email">Email *</label>
        <input 
          id="email" 
          type="email" 
          pInputText 
          formControlName="email" 
          placeholder="Enter email address" />
        <small 
          *ngIf="studentForm.get('email')?.invalid && studentForm.get('email')?.touched" 
          class="p-error">
          Valid email is required
        </small>
      </div>

      <div class="form-field">
        <label for="enrollmentDate">Enrollment Date *</label>
        <input 
          id="enrollmentDate" 
          type="date" 
          pInputText 
          formControlName="enrollmentDate" />
        <small 
          *ngIf="studentForm.get('enrollmentDate')?.invalid && studentForm.get('enrollmentDate')?.touched" 
          class="p-error">
          Enrollment date is required
        </small>
      </div>

      <div class="form-field">
        <label for="courses">Courses *</label>
        <p-multiSelect 
          id="courses"
          [options]="availableCourses" 
          formControlName="courses" 
          placeholder="Select courses"
          [style]="{'width': '100%'}"
          [filter]="true"
          filterPlaceHolder="Search courses">
        </p-multiSelect>
        <small 
          *ngIf="studentForm.get('courses')?.invalid && studentForm.get('courses')?.touched" 
          class="p-error">
          At least one course is required
        </small>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancel" 
        icon="pi pi-times" 
        (onClick)="displayAddDialog = false" 
        styleClass="p-button-text">
      </p-button>
      <p-button 
        label="Add Student" 
        icon="pi pi-check" 
        (onClick)="addStudent()" 
        [disabled]="studentForm.invalid">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Edit Student Dialog -->
  <p-dialog 
    header="Edit Student Courses" 
    [(visible)]="displayEditDialog" 
    [modal]="true" 
    [style]="{ width: '500px' }"
    [draggable]="false"
    [resizable]="false">
    
    <div *ngIf="selectedStudent" class="student-info">
      <p><strong>Student:</strong> {{ selectedStudent.firstName }} {{ selectedStudent.lastName }}</p>
      <p><strong>Email:</strong> {{ selectedStudent.email }}</p>
    </div>

    <form [formGroup]="editStudentForm">
      <div class="form-field">
        <label for="editCourses">Courses *</label>
        <p-multiSelect 
          id="editCourses"
          [options]="availableCourses" 
          formControlName="courses" 
          placeholder="Select courses"
          [style]="{'width': '100%'}"
          [filter]="true"
          filterPlaceHolder="Search courses">
        </p-multiSelect>
        <small 
          *ngIf="editStudentForm.get('courses')?.invalid && editStudentForm.get('courses')?.touched" 
          class="p-error">
          At least one course is required
        </small>
      </div>
    </form>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancel" 
        icon="pi pi-times" 
        (onClick)="displayEditDialog = false" 
        styleClass="p-button-text">
      </p-button>
      <p-button 
        label="Update" 
        icon="pi pi-check" 
        (onClick)="updateStudent()" 
        [disabled]="editStudentForm.invalid">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Confirmation Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
